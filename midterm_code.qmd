
---
title: "An Investigation into Model Performance for Identification of Human vs. AI text"
subtitle: "A report to the Quantum Insight AI research team."
author: "Jenny, Lauren, Amalia"
date: last-modified
format:
  pdf:
    number-sections: true
    indent: true
    toc: false
    include-in-header:
      text: |
        \addtokomafont{disposition}{\rmfamily}
execute:
  echo: false
---

# Statement of the Problem
Quantum Insights is aiming to distinguish human-authored text from AI-generated content. The team developed initial models that, on in-sample test data, correctly differentiated human-generated text from AI generated text with high accuracy ($81.78%-96.25%$). When this model was applied to out-of sample test data, however, the accuracy of the models drops significantly, with the lowest accuracy on the meta models being $52.25%$. Our team is interested in determining the contributing factors to this drop in performance and recommending potential next steps to solve this problem and improve the models' accuracy.

# Approach
We first read and pre-processed the data. Then, we used the varImp function to identify the most important features used for classification in the original models. Following this, we used correlation matrices to find connections between these features and across the different data samples. A comparison was made between human-written and AI-generated texts to check for correlated features.


# Summary of Findings



# Recommendations


\newpage
# Appendix

```{r, include=FALSE}
library(quanteda)
library(quanteda.textstats)
library(tidyverse)
library(knitr)
library(gt)
library(syuzhet)
library(dplyr)
library(nFactors)
library(randomForest)
library(caret)
library(kableExtra)
source("../R/helper_functions.R")
source("../R/keyness_functions.R")
source("../R/mda_functions.R")
load("models/rf_models.rda")
```


```{r}
biber_test <- read_tsv("arxiv_sample/arxiv_biber.tsv", 
                       show_col_types = FALSE)

model_names <- c("ChatGPT", "Meta LLaMA 70B Instruct", "Meta LLaMA 70B")
selected_model_indices <- c(1, 3, 4)  
var_importance_results <- list()

var_importance_results <- list()
for (i in seq_along(selected_model_indices)) {
  rf <- rf_models[[selected_model_indices[i]]]
  importance <- varImp(rf, scale = FALSE)
  model_name <- model_names[i]
  
  var_importance_results[[model_name]] <- as.data.frame(importance$importance) %>%
    rownames_to_column("Feature") %>%
    arrange(desc(Overall)) %>%
    slice(1:5) %>%
    select(Feature, Overall)
}
```

```{r}
kable(var_importance_results["ChatGPT"], caption = "Top 5 Important Features for ChatGPT") %>% kable_styling(latex_options = "striped", font_size = 10) %>%
 kable_styling(latex_options = "HOLD_position")

kable(var_importance_results["Meta LLaMA 70B Instruct"], caption = "Top 5 Important Features for Meta LLaMA 70B  Instruct") %>% kable_styling( latex_options = "striped", font_size = 10) %>%
  kable_styling(latex_options = "HOLD_position")


kable(var_importance_results["Meta LLaMA 70B"], caption = "Top 5 Important Features for Meta LLaMA 70B") %>% kable_styling(latex_options = "striped", font_size = 10)  %>% kable_styling(latex_options = "HOLD_position")

```

```{r, include = FALSE}
####read in biber data ####
human_chunk_biber <- read_tsv("hape_sample/biber_data/biber_chunk_2.tsv")

gpt_4o_biber <- read_tsv("hape_sample/biber_data/biber_gpt-4o-2024-08-06.tsv")

gpt_4o_mini_biber <- read_tsv("hape_sample/biber_data/biber_gpt-4o-mini-2024-07-18.tsv")

meta_llama_3_8b_biber <- read_tsv("hape_sample/biber_data/biber_Meta-Llama-3-8B.tsv")

meta_llama_3_8b_Instruct_biber <- read_tsv("hape_sample/biber_data/biber_Meta-Llama-3-8B-Instruct.tsv")

meta_llama_3_70B_biber <- read_tsv("hape_sample/biber_data/biber_Meta-Llama-3-70B.tsv")

meta_llama_3_70B_Instruct_biber <- read_tsv("hape_sample/biber_data/biber_Meta-Llama-3-70B-Instruct.tsv")

arxiv_biber <- read_tsv("arxiv_sample/arxiv_biber.tsv")
```

```{r}

arxiv_biber_human <- arxiv_biber %>% 
  filter(str_detect(doc_id, "human")) %>%
  select(where(~ is.numeric(.x) && sum(.x) != 0))

arxiv_biber_machine <- arxiv_biber %>% 
  filter(str_detect(doc_id, "machine")) %>%
  select(where(~ is.numeric(.x) && sum(.x) != 0))

# only filter arxiv out 

```

```{r, fig.cap="Correlation Matrix of Out-Sample Human", out.height = "50%", out.width="50%"}
bc_cor <- cor(arxiv_biber_human[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```
```{r, fig.cap="Correlation Matrix of Out-Sample Machine", out.height = "50%", out.width="50%"}
bc_cor <- cor(arxiv_biber_machine[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```

```{r, fig.cap="Correlation Matrix of In-Sample Human", out.height = "50%", out.width="50%"}
bc_cor <- cor(human_chunk_biber[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```
```{r, fig.cap="Correlation Matrix of In-Sample GPT 4o", out.height = "50%", out.width="50%"}
bc_cor <- cor(gpt_4o_biber[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```


```{r, fig.cap="Correlation Matrix of In-Sample Meta 70B", out.height = "50%", out.width="50%"}
bc_cor <- cor(meta_llama_3_70B_biber[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```
```{r, fig.cap="Correlation Matrix of In-Sample Meta 70B Instruct", out.height = "50%", out.width="50%"}
bc_cor <- cor(meta_llama_3_70B_Instruct_biber[-1], method = "pearson")
corrplot::corrplot(bc_cor, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45, diag = F, tl.cex = 0.2)
```
